<!DOCTYPE html>
<html>

<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Perturbed-Attention Guidance</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <meta property="og:image" content="img/cats.png"> -->
    <!-- <meta property="og:image:type" content="image/png"> -->
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ku-cvlab.github.io/Perturbed-Attention-Guidance/">
    <meta property="og:title" content="Self-Rectifying Diffusion Sampling with Perturbed-Attention Guidance">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/codemirror.min.css">
    <link rel="stylesheet" href="css/app.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/codemirror.min.js"></script>
    <script src="js/clipboard.min.js"></script>
    <script src="js/video_comparison.js"></script>
    <script src="js/app.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QVFM103BVF"></script>
<script>
    // window.dataLayer = window.dataLayer || [];
    // function gtag() { dataLayer.push(arguments); }
    // gtag('js', new Date());

    // gtag('config', 'G-QVFM103BVF');
</script>

<!-- Image Comparison Slider -->
<!-- https://github.com/sneas/img-comparison-slider -->
<script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css" />

<body>
    <div style="margin-left:5%; margin-right:5%">
        <div class="container" id="header" style="text-align: center; margin: auto;">
            <div class="row" id="title-row" style="max-width: 100%; margin: 10 auto; display: inline-block">
                <h1 class="col-md-12 text-center" style="margin-top: 70px;" id="title">
                    Self-Rectifying Diffusion Sampling <br>with <b>Perturbed-Attention Guidance</b>
                    <!-- <small>
                    Arxiv 2024
                </small> -->
                </h1>
            </div>
            <div class="row" id="author-row" style="margin:0 auto;">
                <div class="col-md-12 text-center" style="display: table; margin:0 auto;">
                    <a style="text-decoration:none" href="https://github.com/sunovivid">
                        Donghoon&nbsp;Ahn<sup>*1</sup>
                    </a>
                    <span style="padding-left: 20px;"></span>
                    <!-- <a style="text-decoration:none" href="https://github.com/ONground-Korea"> -->
                    Hyoungwon&nbsp;Cho<sup>*1</sup>
                    <!-- </a> -->
                    <span style="padding-left: 20px;"></span>
                    <a style="text-decoration:none" href="https://github.com/Min-Jaewon">
                        Jaewon&nbsp;Min<sup>1</sup>
                    </a>
                    <span style="padding-left: 20px;"></span>
                    <!-- <a style="text-decoration:none" href="https://github.com/loggerJK"> -->
                    Wooseok&nbsp;Jang<sup>1</sup>
                    <!-- </a> -->
                    <span style="padding-left: 20px;"></span>
                    <!-- <a style="text-decoration:none" href="https://github.com/seong0905"> -->
                    Jungwoo&nbsp;Kim<sup>1</sup>
                    <br>
                    <!-- </a> -->
                    <span style="padding-left: 20px;"></span>
                    <!-- <a style="text-decoration:none" href="https://cvlab.korea.ac.kr"> -->
                    SeonHwan&nbsp;Kim<sup>1</sup>
                    <!-- </a> -->
                    <span style="padding-left: 20px;"></span>
                    <!-- <a style="text-decoration:none" href="https://cvlab.korea.ac.kr"> -->
                    Hyunhee Park<sup>2</sup>
                    <!-- </a> -->
                    <span style="padding-left: 20px;"></span>
                    <a style="text-decoration:none" href="https://ipa.korea.ac.kr">
                        Kyonghwan Jin<sup>1&dagger;</sup>
                    </a>
                    <span style="padding-left: 20px;"></span>
                    <a style="text-decoration:none" href="https://cvlab.korea.ac.kr">
                        Seungryong Kim<sup>1&dagger;</sup>
                    </a>
                    <br>
                    <small>
                        *&nbsp; Equal Contribution 
                        <span style="padding-left: 20px;"></span>
                        &dagger;&nbsp; Co-corresponding author
                    </small>
                    <table class="author-table" id="author-table">
                        <td>
                            <br>
                            <sup>1</sup>&nbsp;
                            Korea University
                        </td>
                        <td>
                            <br>
                            <sup>2</sup>&nbsp;
                            Samsung Electronics
                        </td>
                    </table>

                </div>
            </div>
        </div>
        <script>
            document.getElementById('author-row').style.maxWidth = document.getElementById("-row").clientWidth + 'px';
        </script>

        <div class="container" id="main">
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 text-center">
                    <ul class="nav nav-pills nav-justified">
                        <li>
                            <a href="http://arxiv.org/abs/2403.">
                                <img src="./img/paper_image.png" height="60px">
                                <h4><strong>Paper</strong></h4>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/KU-CVLAB/Perturbed-Attention-Guidance-ADM" target="_blank">
                                <image src="img/github.png" height="60px">
                                    <h4><strong>Code<br>(ADM)</strong></h4>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/KU-CVLAB/Perturbed-Attention-Guidance" target="_blank">
                                <image src="img/github.png" height="60px">
                                    <h4><strong>Code<br>(Stable Diffusion)</strong></h4>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- <div class="container"> -->
            <div class="row">
                <div class="text-center">
                    <img src="./img/teaser.png" style="width: 80%;" width="100%">
                </div>
                <br>
                <div style="text-align:justify">
                    <strong>Qualitative comparisons between unguided (baseline) and perturbed-attention-guided (PAG)
                        diffusion samples.</strong>
                    Without any <strong><i>external conditions</i></strong>, <i>e.g.</i>, class labels or text prompts,
                    or <strong><i>additional training</i></strong>,
                    our <strong>PAG</strong> dramatically elevates the quality of diffusion samples even in
                    unconditional generation,
                    where classifier-free guidance (CFG) is inapplicable. Our guidance can also enhance the baseline
                    performance in various downstream tasks such as ControlNet with empty prompt
                    and image restoration such as inpainting and deblurring.
                </div>
            </div>
            <!-- </div> -->

            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2>
                        Abstract
                    </h2>
                </div>
                <div style="text-align:justify;  margin-left:10%; margin-right:10%">
                    Recent studies prove that diffusion models can generate high-quality samples, but their quality is
                    often highly reliant on sampling guidance techniques such as classifier guidance (CG) and
                    classifier-free guidance (CFG), which are inapplicable in unconditional generation or various
                    downstream tasks such as image restoration. In this paper, we propose a novel diffusion sampling
                    guidance, called <b>Perturbed-Attention Guidance (PAG)</b>, which improves sample quality across
                    both unconditional and conditional settings, achieving this without requiring further training or
                    the integration of external modules. PAG is designed to progressively enhance the structure of
                    synthesized samples throughout the denoising process by considering the self-attention mechanisms'
                    ability to capture structural information. It involves generating intermediate samples with degraded
                    structure by substituting selected self-attention maps in diffusion U-Net with an identity matrix,
                    and guiding the denoising process away from these degraded samples.
                </div>
                <br><br>
                <div class="text-center col-md-offset-0">
                    <h2>
                        Guided Diffusion Results
                    </h2>
                </div>
                <!-- <div class="text-center col-md-offset-0" style="margin-left: 10px;"> -->
                <div class="text-center col-md-offset-0">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>
                                <p>Unconditional Generation</p>
                            </strong>
                        </div>
                        <div class="col-md-6">
                            <strong>
                                <p>Conditional Generation</p>
                            </strong>
                        </div>
                    </div>
                    <img-comparison-slider style="width: 49%;" hover="hover">
                        <img slot="first" src="imgs/baseline/adm_uncond_baseline.png" width="100%" />
                        <img slot="second" src="imgs/ours/adm_uncond_ours.png" width="100%" />
                    </img-comparison-slider>
                    <img-comparison-slider style="width: 49%;" hover="hover" hover="hover">
                        <img slot="first" src="imgs/baseline/adm_cond_baseline0.png" width="100%" />
                        <img slot="second" src="imgs/ours/adm_cond_ours0.png" width="100%" />
                    </img-comparison-slider>
                </div>
            </div>
            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2>
                        Stable Diffusion Results
                    </h2>
                </div>
                <div class="text-center col-md-offset-0">
                    <strong>
                        <p>Unconditional Generation</p>
                    </strong>
                    <img-comparison-slider style="width: 49%;" hover="hover">
                        <img slot="first" src="imgs/baseline/sd_uncond_baseline_quarter.png" width="100%" />
                        <img slot="second" src="imgs/ours/sd_uncond_ours_quarter.png" width="100%" />
                    </img-comparison-slider>
                    <strong>
                        <p>Conditional Generation (CFG vs CFG + Ours)</p>
                    </strong>
                    <img-comparison-slider style="width: 75%;" hover="hover">
                        <img slot="first" src="imgs/baseline/sd_cfg.png" width="100%" />
                        <img slot="second" src="imgs/ours/sd_cfg_ours.png" width="100%" />
                    </img-comparison-slider>
                </div>
            </div>

            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2>
                        Overall Framework
                    </h2>
                    <img src="img/architecture.png" style="width: 75%;" width="100%">
                    <div style="text-align:justify;  margin-left:10%; margin-right:10%">
                        <strong>Conceptual comparison between CFG and PAG.</strong> CFG employs
                        jointly trained unconditional model as the undesirable path, whereas PAG utilizes
                        perturbed self-attention for the same purpose. \(\mathbf{A}_t\) corresponds to the
                        self-attention
                        map \(\mathrm{Softmax}({Q_t}{K^T_t}/\sqrt{d})\). In PAG, we perturb this by replacing with an
                        identity
                        matrix \(I\).
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2>
                        Application to Downstream Tasks
                    </h2>
                </div>

                <div class="text-center col-md-offset-0">
                    <strong>
                        <p>Image Restoration (<a
                                href="https://github.com/LituRout/PSLD/tree/main?tab=readme-ov-file">PSLD</a>)</p>
                    </strong>
                    <img src="imgs/applications/psld_quarter.png" style="width: 75%;" width="100%">
                    <!-- <img-comparison-slider style="width: 49%;" hover="hover">
                        <img slot="first" src="imgs/baseline/sd_uncond_baseline_quarter.png" width="100%" />
                        <img slot="second" src="imgs/ours/sd_uncond_ours_quarter.png" width="100%" />
                    </img-comparison-slider> -->
                    <!-- <p>unconditional generation (combined with CFG)</p>
                    <img-comparison-slider style="width: 75%;" hover="hover">
                        <img slot="first" src="imgs/baseline/sd_cfg.png" width="100%" />
                        <img slot="second" src="imgs/ours/sd_cfg_ours.png" width="100%" />
                    </img-comparison-slider> -->
                </div>
            </div>

            <div class="row">
                <div class="col-md-offset-0">
                    <h3>
                        Citation
                    </h3>
                    If you find our work useful in your redreasearch, please cite our work as:
                    <div class="form-group col-md-10">
                        <pre>
@misc{,
    title={Self-Rectifying Diffusion Sampling with Perturbed-Attention Guidance}, 
    author={},
    year={2024},
    eprint={2403.},
    archivePrefix={arXiv},
    primaryClass={cs.CV}
}</pre>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-offset-0">
                    <h3>
                        Acknowledgements
                    </h3>
                    <p class="text-justify">
                        <!-- We would like to thank Lior Yariv and Kai Zhang for helping us evaluate their methods, and Ricardo Martin-Brualla for helpful comments on our text. DV is supported by the National Science Foundation under Cooperative Agreement PHY-2019786 (an NSF AI Institute, <a href="http://iaifi.org">http://iaifi.org</a>) -->
                        <!-- <br> -->
                        The website template was borrowed from <a href="http://mgharbi.com/">Michaël Gharbi</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>
    </div>

    </div>
</body>

</html>